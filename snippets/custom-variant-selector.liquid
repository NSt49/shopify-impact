<div class="custom-variant-selector">
  {% assign displayed_variants = product.variants | slice: 0, 3 %}

  {% for variant in displayed_variants %}
    <label class="custom-variant-selector__block{% if forloop.first %} selected{% endif %}" data-variant-id="{{ variant.id }}">
      <span class="variant-indicator"></span>
      <input type="radio" name="custom_variant_id" class="hidden-radio" value="{{ variant.id }}" {% if forloop.first %}checked{% endif %}>
      <div class="variant-card">
        {% if forloop.index == 1 or forloop.index == 2 %}
          <div class="variant-badge">Économisez 50€</div>
        {% endif %}
        <img src="{{ variant.featured_image | img_url: '300x' }}" alt="{{ variant.title }}">
        <p class="variant-label">{{ variant.title }}</p>
        <p class="variant-price">{{ variant.price | money }}</p>
      </div>
    </label>
  {% endfor %}
</div>

<style>
.custom-variant-selector {
  display: flex;
  gap: 16px;
  margin-top: 20px;
  flex-wrap: wrap;
  justify-content: center;
}
.custom-variant-selector__block {
  border: 2px solid #ccc;
  border-radius: 10px;
  padding: 10px;
  width: 48%;
  text-align: center;
  position: relative;
  cursor: pointer;
}
.custom-variant-selector__block.selected {
  border-color: #000;
  background-color: #f6f6f6;
}
.variant-card img {
  max-width: 100%;
  margin-top: 20px;
}
.variant-badge {
  position: absolute;
  top: 6px;
  left: 6px;
  background: #d32f2f;
  color: white;
  padding: 4px 10px;
  font-size: 12px;
  border-radius: 6px;
}
.variant-indicator {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  border: 2px solid #000;
  display: inline-block;
  position: absolute;
  top: 10px;
  right: 10px;
}
.custom-variant-selector__block.selected .variant-indicator {
  background: #000;
}
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const selectorBlocks = document.querySelectorAll(".custom-variant-selector__block");
    const hiddenInput = document.querySelector('form[action^="/cart/add"] input[name="id"]');

    selectorBlocks.forEach(block => {
      block.addEventListener("click", function () {
        selectorBlocks.forEach(b => b.classList.remove("selected"));
        this.classList.add("selected");

        const variantId = this.getAttribute("data-variant-id");
        const radio = this.querySelector("input[type='radio']");
        if (radio) radio.checked = true;
        if (hiddenInput) hiddenInput.value = variantId;
      });
    });
  });
</script>
